<!DOCTYPE html>
<html lang="en">

<head>
    <style type="text/css">
        
        #status {
  /*position: fixed;*/
  width: 100%;
  font: bold 1em sans-serif;
  color: #FFF;
  padding: 0.5em;
}

#log {
  padding: 2.5em 0.5em 0.5em;
  font: 1em sans-serif;
}

.online {
  background: green;
}

.offline {
  background: red;
}
    </style>
    <!-- Normalize.css for better cross-browser consistency -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#804C1E"/>
     <meta name="keywords" content="MWS,Stage2,Development,UDACity,Google">
     <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" src="//normalize-css.googlecode.com/svn/trunk/normalize.css" />
    <!-- Main CSS file -->
    <link rel="stylesheet" href="css/mini-css.css" >
    <link rel="preload"   href="css/mini-css.css" as="style" >
     <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">-->
    <!-- Custome CSS file 
    <link rel="stylesheet" href="css/custome-styles.css">-->
    <title>Restaurant Info</title>
</head>

<body class="inside">
    <!-- Beginning header -->
    <header>
        <!-- Beginning nav -->
        <nav>
            <h1><a href="/">Restaurant Reviews</a></h1>
        </nav>
        <!-- Beginning breadcrumb -->
        <ul id="breadcrumb" role="list"   aria-label="breadcrumb" >
            <li><a href="/">Home</a></li>
        </ul>
           <!--  <label id="ham" class="menu" for="toogle">&#9776</label>-->
        <img  src="img/map-icon2.webp"  alt="icon to show map" id="ham" class="menu" for="toogle" />  
       
       <!--< <input type="checkbox" id="toogle" ></input> -->
        <!-- End breadcrumb -->
        <!-- End nav -->
    </header>
    <!-- End header -->
    <!-- Beginning main -->
    <main id="maincontent">
        <!-- Beginning map -->
        <section id="map-container" class="drawer">
            <div id="map" aria-role="map" aria-label="Restaurant location" aria-hidden="true"></div>
        </section>
        <!-- End map -->
        <!-- Beginning restaurant -->
        <section id="restaurant-container">
            <h1 id="restaurant-name"></h1>
            <img id="restaurant-img">
            <p id="restaurant-cuisine"></p>
            <p id="restaurant-address"></p>
            <table id="restaurant-hours"></table>

            <!-- Rounded switch -->
            <label class="FavoritClass" name ="Favorit Label" > Is Favorit  : </label>
            <label name ="Favorit Button" class="switch">
                  <input type="checkbox" id="FavoritCheckBox">
                  <span class="slider round"></span>
            </label>

        </section>
        <!-- end restaurant -->
        <!-- Beginning reviews -->
        <section id="reviews-container">
            <ul id="reviews-list"></ul>

        </section>
        <section id="reviews-container-form">
            <form action="/" method="post">
                    <b class="title">User name : </b>  <input type="text" id="username" aria-label="User name" name="username" >
                    <br><br>
                    <b class="title" aria-label="User Rate"> Rating : </b>   
                              <span aria-label="one star"  id="firstStar" class="fa fa-star"></span>
                              <span aria-label="two stars" id="secondStar" class="fa fa-star"></span>
                              <span  aria-label="three stars"id="thirdStar" class="fa fa-star"></span>
                              <span  aria-label="four stars"id="fourthStar" class="fa fa-star"></span>
                              <span  aria-label="five star" id="fifthStar" class="fa fa-star"></span>
                    <br><br>
                    <b class="title"  > Comments :</b>  
                    <textarea rows="4"  aria-label="User Comments" id="commentname" name="commentname">
                    </textarea>
                    <br><br>
                    <input type="button" id="addreview" value="Add Review"></input>
                    <br>
            </form>

              <div id="status"></div>
        <div id="log"></div>
        </section>


      
        <!-- End reviews -->
    </main>
    <!-- End main -->
    <!-- Beginning footer -->
    <footer id="footer">
        Copyright (c) 2017 <a href="/"><strong>Restaurant Reviews</strong></a> All Rights Reserved.
    </footer>
    <!-- End footer -->
    <!-- Beginning scripts -->
    <!-- Database helpers -->
    <script >
    function init()
   {
   if(!navigator.serviceWorker) return;
    
  navigator.serviceWorker
           .register('SW1.js') 
           .then(function() { 
                console.log("Service Worker Registered"); 

                navigator.serviceWorker.ready.then(function(swRegistration) {
                    console.log("first sync Registered"); 
                  return swRegistration.sync.register('myFirstSync');

                }).then(function(){
                     console.log("second check first sync Registered"); 
                });

               }).catch(function(){
                   console.log("Failed to register");
               });
}

window.addEventListener('load', function() {
  var status = document.getElementById("status");
  var log = document.getElementById("log");

  function updateOnlineStatus(event) {
    var condition = navigator.onLine ? "online" : "offline";

    status.className = condition;
    status.innerHTML = condition.toUpperCase();

    log.insertAdjacentHTML("beforeend", "Event: " + event.type + "; Status: " + condition);
  }


function addreviewoffline(event)
{
        updateOnlineStatus(event);
        if(navigator.onLine == true)
        {
        getDataFromOutbox().then(function(messages) {
          // Post the messages to the server
          return fetch('http://localhost:1337/reviews/', {
          method: 'POST',
          body: JSON.stringify(messages),
          headers: { 'Content-Type': 'application/json' }
          }).then(function(rev)  {
          // Success! Remove them from the outbox       
          removeDataFromOutbox();
          //return rev;
          });
          //return messages;
      })
        }
}



    function getDataFromOutbox(){
    return dbNew_Reviews
    .then(function(db){
        var tx = db.transaction('new-review', 'readonly');
      var store = tx.objectStore('new-review');
      //console.log(url);
      return store.getAll();
    })
    .then(function(data){
        return data;
      console.log(data);
    })
    .catch(function(err){
      console.log(err);
    });
  }

  function removeDataFromOutbox(){
    return dbNew_Reviews
    .then(function(db){
      var tx = db.transaction('new-review', 'readwrite');
      var store = tx.objectStore('new-review');
      return store.clear();
    })
    .then(function(){
      console.log('deleted')
    })
    .catch(function(e){
      console.log(e);
    });
}


  window.addEventListener('online',  addreviewoffline);
  window.addEventListener('offline', addreviewoffline);
});
</script>
    <script type="text/javascript" src="js/dbhelper.js"></script>
    <!-- Main javascript file -->
    <script type="text/javascript" src="js/restaurant_info.js"></script>
     <script src="js/idb.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/indexDB.js"></script>

    <!-- Google Maps -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAhgkahpB5UZ-keXKZz1U8CS9wkdrLxMTA&libraries=places&callback=initMap"></script>
    <!-- End scripts -->

</body>

</html>
