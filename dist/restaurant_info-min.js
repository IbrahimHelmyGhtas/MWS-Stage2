let restaurant;var map;let currentRate;document.addEventListener("DOMContentLoaded",e=>{init(),fetchRestaurantFromURL((e,t)=>{e?console.error(e):fillBreadcrumb()})}),document.getElementById("restaurantimg").addEventListener("click",e=>{initMapForRest()}),document.getElementById("ham").addEventListener("click",function(e){document.getElementById("map-container").classList.toggle("open"),e.stopPropagation()}),document.getElementById("FavoritCheckBox").addEventListener("change",function(e){var t=document.getElementById("FavoritCheckBox").checked;const n=getParameterByName("id");dbPromise.then(function(e){return e.transaction("restaurants","readwrite").objectStore("restaurants").openCursor()}).then(function e(r){if(r&&r){if(r.value.id==n){var a=r.value;a.is_favorite=t;r.update(a)}return r.continue().then(e)}}).then(function(){console.log("Added successfully for review store")}).then(function(){fetch("http://localhost:1337/restaurants/"+n+"/?is_favorite="+t,{method:"PUT"}).then(e=>e.json()).catch(e=>console.error("Error Form favorit:",e)).then(e=>{console.log("Restaurant favorit :",e)})}),e.stopPropagation()}),document.getElementById("addreview").addEventListener("click",function(e){var t=new FormData;const n=getParameterByName("id"),r=document.getElementById("username").value,a=document.getElementById("commentname").value,o=document.getElementById("RateSelect").value;t.append("restaurant_id",n),t.append("name",r),t.append("rating",o),t.append("comments",a),dbPromiseReviews.then(function(e){return e.transaction("reviews","readonly").objectStore("reviews").index("reviewid").openCursor(null,"prev")}).then(function(e){e&&(maxRevisionObject=e.value,rev=new Object,rev.restaurant_id=n,rev.name=r,rev.rating=o,rev.comments=a,rev.id=maxRevisionObject.id+1,rev.createdAt=new Date,rev.updatedAt=new Date),dbPromiseReviews.then(function(e){var t=e.transaction("reviews","readwrite");return t.objectStore("reviews").put(rev),t.complete}).then(function(){console.log("Added successfully for review store")}).then(function(){dbNew_Reviews.then(function(e){if(0==navigator.onLine){var t=e.transaction("new-review","readwrite");return t.objectStore("new-review").put(rev),t.complete}}).then(function(e){document.getElementById("reviews-list").appendChild(createReviewHTML(rev)),alert("Review added successfully."),console.log("Added successfully for new-review store")}).then(function(e){1==navigator.onLine&&fetch("http://localhost:1337/reviews/",{method:"POST",body:t}).then(e=>{const t=e.json();return console.log("object response result:",t),t}).catch(e=>console.log("Error Form:",e))})})}),e.stopPropagation()}),window.initMapForRest=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?(DBHelper.fetchRestaurantById(t,(n,r)=>{self.restaurant=r,r?(fillRestaurantHTML(),document.getElementById("restaurantimg").src="img/rest"+t+".webp",e(null,r)):console.error(n)}),DBHelper.fetchReviewsByRestaurantId(t,(e,t)=>{self.reviews=t,t?fillReviewsHTML():console.error(e)})):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.alt="restaurant : "+e.name,t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),"true"==e.is_favorite?document.getElementById("FavoritCheckBox").checked=!0:document.getElementById("FavoritCheckBox").checked=!1}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const o=document.createElement("td");o.innerHTML=e[n],r.appendChild(o),t.appendChild(r)}}),fillReviewsHTML=((e=self.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,n.classList.add("UserNameReview"),t.appendChild(n);const r=document.createElement("p");r.innerHTML=new Date(e.createdAt).toLocaleString("en-US"),r.classList.add("UserDateReview"),t.appendChild(r);const a=document.createElement("p");a.innerHTML=` Rating : ${e.rating}`,a.classList.add("RateClass"),t.appendChild(a);const o=document.createElement("p");return o.innerHTML=e.comments,o.classList.add("UserCommentReview"),t.appendChild(o),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});